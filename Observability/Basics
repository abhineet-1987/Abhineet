Method of metric collection:-
  Push : In the push method, your applications or microservices will send the metrics to the time series database
        via an endpoint that is provided by the time series database (eg graphite) and via protocols such as TCP, UDP, or HTTP.
  Scrape : So your application or microservices must provide some API for the time series database to read the metrics. 
        Example of a scrape method is when Prometheus scrapes the metrics from your, say, Python or dotnet or Java application.

Types of telemetry data:-
MELT
Metrics : So a metric is an aggregated value representing events in a period of time.
Events : action happenning at a given time
Logs :  very detailed representation of an event
Trace : Shows interactionof microservices to fulfill a request

### Install Prometheus on Mac-OS:
brew install prometheus
Go to path /opt/homebrew/etc
brew services start prometheus
On web browser open http://localhost:9090


What is consul_exporter as given in https://prometheus.io/download/ website?
consul_exporter is a service that scrapes Consul’s HTTP API and exposes Consul metrics at /metrics so Prometheus can scrape them.
It acts as a bridge between:
Consul (source of data)
Prometheus (metrics storage & alerting)

#### Install Prometheus on Ubuntu 
sudo su
Go to https://prometheus.io/download/
wget https://github.com/prometheus/prometheus/releases/download/v3.5.0/prometheus-3.5.0.linux-arm64.tar.gz
tar xvf prometheus-3.5.0.linux-arm64.tar.gz
nohup ./prometheus --config.file=prometheus.yml &
On web browser open http://<ip-of-multipass-vm>:9090

##### Data Collection 
Source system emitting metrics --------> Exporter (customized as per source) --------> Prometheus

Exporters collect metrics from applications or systems and expose them in Prometheus format.
Prometheus scrapes these exporters to store metrics and trigger alerts.
Exporters translate system- or service-specific metrics into Prometheus format (e.g., SQL query stats, Consul health, HAProxy traffic).
Examples: mysqld_exporter / postgres_exporter for SQL databases, consul_exporter for Consul catalog & health, cloudwatch_exporter for AWS CloudWatch metrics, and haproxy_exporter for HAProxy requests, errors, and latency.

####### Node exporter:
Node exporter is an official Prometheus exporter for collecting metrics that are exposed by Unix based kernels, for example Ubuntu and Linux servers. So some of the metrics that we can collect using node exporter include, but obviously not limited to
CPU usage, disk usage, memory and network IO.

On ubuntu multipass VM:-
Go to https://prometheus.io/download/#node_exporter
wget https://github.com/prometheus/node_exporter/releases/download/v1.10.2/node_exporter-1.10.2.linux-arm64.tar.gz
tar xvf node_exporter-1.10.2.linux-arm64.tar.gz
cd node_exporter-1.10.2.linux-arm64
./node_exporter
hostname -I # to get the ip of multipass VM
On your browser open http://192.168.64.5:9100 to view the node metrics

###### Data Model in Prometheus #######
So in Prometheus, obviously data is stored as time series, which means that we have a metric and there
is a timestamp, a Linux timestamp attached to it.
So every time series in Prometheus is identified by a metric name and labels.
And when we say a label is basically a key value pair.

########
Logs → Loki
Traces → Tempo
Metrics → Prometheus / Mimir
              ↓
           Grafana
        (visualization)
##########
App / Node
   ↓
Grafana Alloy   ← collects
   ↓
-------------------------
| Prometheus → metrics |
| Loki       → logs    |
| Tempo      → traces  |
-------------------------
        ↓
     Grafana UI

Alloy:
One agent for all telemetry
Replaces multiple exporters
Uses OpenTelemetry internally
#################
| Component  | Role           |
| ---------- | -------------- |
| **Alloy**  | Collect & ship |
| Prometheus | Store metrics  |
| Loki       | Store logs     |
| Tempo      | Store traces   |
| Grafana    | Visualize      |

A trace is a record of a single request’s journey across multiple services, showing where time is spent and where failures occur.
Metrics use exporters, logs and traces use collectors—and Alloy can handle all three.
###########
Typical setup without Alloy (very common)
Metrics → Prometheus (exporters)

Logs    → Promtail → Loki      (App logs → Promtail → Loki → Grafana)
OR
App logs → Fluent Bit → Loki / ElastiSearch / CloudWatch
OR
App logs → Fluentd → Loki / ElastiSearch / CloudWatch   (Heavier as compared to Fluent bit and used in complex systems)

Traces  → OTEL Collector → Tempo
#############

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%       GRAFANA             %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
Non-Cloud
Grafana Cloud

###### Installing Grafana on Ubuntu ############
sudo apt-get update 
sudo apt-get install -y adduser libfontconfig1 musl
wget https://dl.grafana.com/oss/release/grafana_10.2.2_amd64.deb      # for amd64
wget https://dl.grafana.com/oss/release/grafana_10.2.2_arm64.deb      # for arm64
sudo dpkg -i grafana_10.2.2_arm64.deb

sudo systemctl daemon-reload
sudo systemctl enable grafana-server
sudo systemctl start grafana-server
sudo systemctl status grafana-server

Ref: 
https://grafana.com/grafana/download?edition=oss

On your multipass VM:
hostname -I

To open Grafan dashboard, on your browser open http://<ip-of-multipass-vm>:3000

########### Configuring Grafana #######
cd /etc/grafana
grafana.ini is the configuration file.  (Note ";" semi colon comments the line, hence remove it if you want tu use particular line in that ini file)

####### Deploying Grafana Stack and Prometheus with Docker on Mac ######
Make sure you have Docker desktop running
https://github.com/aussiearef/grafana-udemy/blob/main/docker/docker-compose.yaml
copy this to your local directory and run:-
docker compose up -d
To view Grafan dashboard open in browser http://localhost:3000
docker compose down # To delete all the container stack deployed using docker compose
####################
Open Grafana Dashboard -> Connections  -> Data Sources -> Add new data source -> Add Prom, Loki, Tempo data sources -> Save and test -> Build a dashboard -> Click on Save Button (you may even click on settings to configure further settings for that dashboard)

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%       LOCI OR GRAFANA LOCI            %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
Install Loci and Promtail on ubuntu
Go to https://github.com/grafana/loki/releases
wget https://github.com/grafana/loki/releases/download/v3.6.3/loki_3.6.3_arm64.deb
sudo dpkg -i loki_3.6.3_arm64.deb

sudo systemctl daemon-reload
sudo systemctl enable loki
sudo systemctl start loki
sudo systemctl status loki
Note: Make sure to update User=root in service config file at /etc/systemd/system else create loki user and add suitable permissions.

Install promtail -------
Go to https://github.com/grafana/loki/releases
wget https://github.com/grafana/loki/releases/download/v3.6.3/promtail-linux-arm64.zip

Go to https://github.com/aussiearef/grafana-udemy/blob/main/loki/promtail-sample-config.yml for promtail config file
./promtail-linux-arm64  -config.file=promtail-config.yaml












