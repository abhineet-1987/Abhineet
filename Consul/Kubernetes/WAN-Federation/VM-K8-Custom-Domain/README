Note: I have used EKS here and deployed Consul on ec2 instance (VM).
Reference Documents: 
https://developer.hashicorp.com/consul/docs/east-west/wan-federation/k8s-vm 
https://developer.hashicorp.com/consul/docs/secure/encryption/tls/mtls#federated-consul-datacenter 
https://developer.hashicorp.com/consul/docs/secure/encryption/gossip/enable
https://developer.hashicorp.com/consul/docs/secure/encryption/tls/mtls
https://developer.hashicorp.com/consul/docs/east-west/mesh-gateway/enable
https://developer.hashicorp.com/consul/tutorials/archive/service-mesh-gateways

VM Primary Cluster Setup:-
 
Create CA and Server TLS certificates:

consul tls ca create -domain consul-lab.myinfo.com
consul tls cert create -server -dc dce -node primary-dc1-node -domain=consul-lab.myinfo.com -additional-dnsname="server.dc3-k3s.consul-lab.myinfo.com"
Following files are generated:

/etc/consul.d/tls_cust# ls -lrt
total 16
-rwxr-xr-x 1 root root 1078 Feb 20 10:57 consul-lab.myinfo.com-agent-ca.pem
-rwxr-xr-x 1 root root  227 Feb 20 10:57 consul-lab.myinfo.com-agent-ca-key.pem
-rwxr-xr-x 1 root root 1135 Feb 20 11:01 dce-server-consul-lab.myinfo.com-0.pem
-rwxr-xr-x 1 root root  227 Feb 20 11:01 dce-server-consul-lab.myinfo.com-0-key.pem

Generate Gossip encryption key
consul keygen
xOq3gO9a3XXXXXXXXXXXXXXMYk=


Consul Server Config:

root@ip-10-0-5-32:/etc/consul.d# cat consul.hcl
# -------------------------
# Core server configuration
# -------------------------
server           = true
bootstrap_expect = 1
datacenter       = "dce"
primary_datacenter = "dce"
domain            = "consul-lab.myinfo.com"
node_name         = "primary-dc1-node"

encrypt = "xOq3gO9a3XXXXXXXXXXXXXXMYk="

bind_addr   = "0.0.0.0"
client_addr = "0.0.0.0"
data_dir    = "/opt/data"
license_path = "/etc/consul.d/license.hclic"


leave_on_terminate = true
enable_debug       = false

# -------------------------
# ACL configuration
# -------------------------
acl {
  enabled                   = true
  default_policy            = "deny"
  down_policy               = "extend-cache"
  enable_token_persistence  = true
  enable_token_replication  = true
  tokens {
    agent = "d20affde-XXXXX-9ea9a7ab4209"
    replication = "d20affde-XXXXX-9ea9a7ab4209"
    default = "d20affde-XXXXX-9ea9a7ab4209"
  }
}

# -------------------------
# Connect / Service Mesh
# -------------------------
connect {
  enabled = true
  enable_mesh_gateway_wan_federation = true
}


enable_central_service_config = true

# -------------------------
# Limits
# -------------------------
limits {
  request_limits {
    mode       = "disabled"
    read_rate  = -1
    write_rate = -1
  }
}

# -------------------------
# Autopilot
# -------------------------
autopilot {
  min_quorum                = 1
  disable_upgrade_migration = true
}

# -------------------------
# Ports (merged from all files)
# -------------------------
ports {
  http      = -1
  https     = 8501
  grpc_tls      = 8502
}

# -------------------------
# TLS configuration
# -------------------------
tls {
  internal_rpc {
    verify_incoming        = true
    verify_outgoing = true
    verify_server_hostname = true
  }

grpc {
    verify_incoming = false
  }


  defaults {
    ca_file   = "/etc/consul.d/tls_cust/consul-lab.myinfo.com-agent-ca.pem"
    cert_file = "/etc/consul.d/tls_cust/dce-server-consul-lab.myinfo.com-0.pem"
    key_file  = "/etc/consul.d/tls_cust/dce-server-consul-lab.myinfo.com-0-key.pem"
  }
}

# -------------------------
# UI
# -------------------------
ui_config {
  enabled = true
}
######################################
Start the Consul
systemctl start consul

Configure the anonymous token policy, first create a policy with the mentioned rules as given below (Refer here), then attach it to the anonymous token:-

echo 'partition_prefix "" {
  namespace_prefix "" {
    node_prefix "" {
      policy = "read"
    }
    service_prefix "" {
      policy = "read"
    }
  }
}' | consul acl policy create -name anonymous -rules -


consul acl token update -id 00000000-0000-0000-0000-000000000002 -policy-name anonymous
 
Register and start the mesh gateway on the VM:-

nohup consul connect envoy -gateway=mesh -register -expose-servers -service "gateway-primary" -address "<private-ip-vm>:8443" -wan-address "<public-ip-vm>:8443"  -grpc-addr "https://<private-ip-vm>:8502" -grpc-ca-file "/etc/consul.d/tls_cust/consul-lab.myinfo.com-agent-ca.pem" &
nohup consul connect envoy -gateway=mesh -register -expose-servers -service "gateway-primary" -address "10.0.5.32:8443" -wan-address "10.0.5.32:8443"  -grpc-addr "https://10.0.5.32:8502" -grpc-ca-file "/etc/consul.d/tls_cust/consul-lab.myinfo.com-agent-ca.pem" &
nohup consul connect envoy -gateway=mesh -register -expose-servers -service "gateway-primary" -address "10.0.5.32:8443" -wan-address "34.222.236.18:8443"  -grpc-addr "https://10.0.5.32:8502" -grpc-ca-file "/etc/consul.d/tls_cust/consul-lab.myinfo.com-agent-ca.pem" &

Note: Working with both the above commands i.e with -wan-address "10.0.5.32:8443" and -wan-address "34.222.236.18:8443" (private and public ip)

Create the Configuration entry for proxy defaults:-

# cat proxy-defaults.hcl
Kind = "proxy-defaults"
Name = "global"
Config {
  protocol = "http"
}
MeshGateway {
  Mode = "local"
}
   
consul config write proxy-defaults.hcl

Restart the Consul 
systemctl restart consul

###############################################################

Kubernetes Secondary Cluster Setup:-
 
Create Kubernetes federation secret
kubectl create secret generic consul-federation \
  --from-file=caCert=consul-lab.myinfo.com-agent-ca.pem \
  --from-file=caKey=consul-lab.myinfo.com-agent-ca-key.pem \
  --from-literal=replicationToken="d20affde-XXXXX-9ea9a7ab4209" \
  --from-literal=gossipEncryptionKey="xOq3gO9a3XXXXXXXXXXXXXXMYk="
Please note: To keep things simple, I have used the same master bootstrap token of the primary cluster as the replication token for the secondary cluster.
 
Values.yaml for Kubernetes Secondary Cluster :-
global:
  name: consul
  datacenter: dc3-k3s
  domain: consul-lab.myinfo.com
  image: hashicorp/consul-enterprise:1.21.4-ent
  enterpriseLicense:
    secretName: consul-ent-license
    secretKey: key
  tls:
    enabled: true
    caCert:
      secretName: consul-federation
      secretKey: caCert
    caKey:
      secretName: consul-federation
      secretKey: caKey

  # Delete this acls section if ACLs are disabled.
  acls:
    manageSystemACLs: true
    replicationToken:
      secretName: consul-federation
      secretKey: replicationToken

  federation:
    enabled: true
    k8sAuthMethodHost: https://DB4869DXXXXXXXXXXXX829DD.gr7.us-west-2.eks.amazonaws.com
    primaryDatacenter: dce
    primaryGateways: ["<private-ip-vm>:8443"]

  gossipEncryption:
    secretName: consul-federation
    secretKey: gossipEncryptionKey


connectInject:
  enabled: true
meshGateway:
  enabled: true
server:
  extraConfig: |
    {
      "primary_gateways": ["<private-ip-vm>"]
    }
  enabled: true
  replicas: 1
 
For validating the WAN federation setup, refer this.
 
Validation results :-
/ $ consul members -wan
Node                     Address          Status  Type    Build       Protocol  DC       Partition  Segment
consul-server-0.dc3-k3s  10.0.6.141:8302  alive   server  1.21.4+ent  2         dc3-k3s  default    <all>
primary-dc1-node.dce     10.0.5.32:8302   alive   server  1.21.4+ent  2         dce      default    <all>

/ $ curl -k https://127.0.0.1:8501/v1/acl/replication?pretty          
{
    "Enabled": true,
    "Running": true,
    "SourceDatacenter": "dce",
    "ReplicationType": "tokens",
    "ReplicatedIndex": 181,
    "ReplicatedRoleIndex": 182,
    "ReplicatedTokenIndex": 190,
    "LastSuccess": "2026-02-20T11:51:51Z"
}
