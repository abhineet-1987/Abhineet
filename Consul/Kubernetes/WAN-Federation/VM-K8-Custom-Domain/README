Note: I have used EKS here and deployed Consul on ec2 instance (VM).
Reference Documents: 
https://developer.hashicorp.com/consul/docs/east-west/wan-federation/k8s-vm 
https://developer.hashicorp.com/consul/docs/secure/encryption/tls/mtls#federated-consul-datacenter 
https://developer.hashicorp.com/consul/docs/secure/encryption/gossip/enable
https://developer.hashicorp.com/consul/docs/secure/encryption/tls/mtls
https://developer.hashicorp.com/consul/docs/east-west/mesh-gateway/enable
https://developer.hashicorp.com/consul/tutorials/archive/service-mesh-gateways

VM Primary Cluster Setup:-
 
Create CA and Server TLS certificates:

consul tls ca create -domain consul-lab.myinfo.com
consul tls cert create -server -dc dce -node primary-dc1-node -domain=consul-lab.myinfo.com -additional-dnsname="server.dc3-k3s.consul-lab.myinfo.com"
Following files are generated:

/etc/consul.d/tls_cust# ls -lrt
total 16
-rwxr-xr-x 1 root root 1078 Feb 20 10:57 consul-lab.myinfo.com-agent-ca.pem
-rwxr-xr-x 1 root root  227 Feb 20 10:57 consul-lab.myinfo.com-agent-ca-key.pem
-rwxr-xr-x 1 root root 1135 Feb 20 11:01 dce-server-consul-lab.myinfo.com-0.pem
-rwxr-xr-x 1 root root  227 Feb 20 11:01 dce-server-consul-lab.myinfo.com-0-key.pem

Generate Gossip encryption key
consul keygen
xOq3gO9a3XXXXXXXXXXXXXXMYk=


Refer Consul Server Config as given in consul.hcl:
Start the Consul
systemctl start consul

Configure the anonymous token policy, first create a policy with the mentioned rules as given below (Refer here), then attach it to the anonymous token:-

echo 'partition_prefix "" {
  namespace_prefix "" {
    node_prefix "" {
      policy = "read"
    }
    service_prefix "" {
      policy = "read"
    }
  }
}' | consul acl policy create -name anonymous -rules -


consul acl token update -id 00000000-0000-0000-0000-000000000002 -policy-name anonymous
 
Register and start the mesh gateway on the VM:-

nohup consul connect envoy -gateway=mesh -register -expose-servers -service "gateway-primary" -address "<private-ip-vm>:8443" -wan-address "<public-ip-vm>:8443"  -grpc-addr "https://<private-ip-vm>:8502" -grpc-ca-file "/etc/consul.d/tls_cust/consul-lab.myinfo.com-agent-ca.pem" &
nohup consul connect envoy -gateway=mesh -register -expose-servers -service "gateway-primary" -address "10.0.5.32:8443" -wan-address "10.0.5.32:8443"  -grpc-addr "https://10.0.5.32:8502" -grpc-ca-file "/etc/consul.d/tls_cust/consul-lab.myinfo.com-agent-ca.pem" &
nohup consul connect envoy -gateway=mesh -register -expose-servers -service "gateway-primary" -address "10.0.5.32:8443" -wan-address "34.222.236.18:8443"  -grpc-addr "https://10.0.5.32:8502" -grpc-ca-file "/etc/consul.d/tls_cust/consul-lab.myinfo.com-agent-ca.pem" &

Note: Working with both the above commands i.e with -wan-address "10.0.5.32:8443" and -wan-address "34.222.236.18:8443" (private and public ip)

Create the Configuration entry for proxy defaults:-

# cat proxy-defaults.hcl
Kind = "proxy-defaults"
Name = "global"
Config {
  protocol = "http"
}
MeshGateway {
  Mode = "local"
}
   
consul config write proxy-defaults.hcl

Restart the Consul 
systemctl restart consul

###############################################################

Kubernetes Secondary Cluster Setup:-
 
Create Kubernetes federation secret
kubectl create secret generic consul-federation \
  --from-file=caCert=consul-lab.myinfo.com-agent-ca.pem \
  --from-file=caKey=consul-lab.myinfo.com-agent-ca-key.pem \
  --from-literal=replicationToken="d20affde-XXXXX-9ea9a7ab4209" \
  --from-literal=gossipEncryptionKey="xOq3gO9a3XXXXXXXXXXXXXXMYk="
Please note: To keep things simple, I have used the same master bootstrap token of the primary cluster as the replication token for the secondary cluster.
 
Refer Values.yaml for Kubernetes Secondary Cluster as given in this folder :-
Execute:-
helm install consul hashicorp/consul --values=values.yaml

For validating the WAN federation setup, refer this.
 
Validation results :-
/ $ consul members -wan
Node                     Address          Status  Type    Build       Protocol  DC       Partition  Segment
consul-server-0.dc3-k3s  10.0.6.141:8302  alive   server  1.21.4+ent  2         dc3-k3s  default    <all>
primary-dc1-node.dce     10.0.5.32:8302   alive   server  1.21.4+ent  2         dce      default    <all>

/ $ curl -k https://127.0.0.1:8501/v1/acl/replication?pretty          
{
    "Enabled": true,
    "Running": true,
    "SourceDatacenter": "dce",
    "ReplicationType": "tokens",
    "ReplicatedIndex": 181,
    "ReplicatedRoleIndex": 182,
    "ReplicatedTokenIndex": 190,
    "LastSuccess": "2026-02-20T11:51:51Z"
}

 $ consul catalog services -datacenter=dc3-k3s
consul
mesh-gateway
/ $ consul catalog services -datacenter=dce
consul
gateway-primary

Similarly you can run these commands on primary Consul cluster except curl to check the WAN Fed validation.
